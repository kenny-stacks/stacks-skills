---
phase: 06-frontend-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/stacks-dev/references/clarity-frontend.md
autonomous: true

must_haves:
  truths:
    - "clarity-frontend.md uses @stacks/connect v8+ API (connect/disconnect/isConnected)"
    - "clarity-frontend.md includes post-conditions with Pc fluent API"
    - "clarity-frontend.md shows transaction status polling pattern"
    - "clarity-frontend.md uses environment-based network configuration"
  artifacts:
    - path: "skills/stacks-dev/references/clarity-frontend.md"
      provides: "Stacks.js frontend integration patterns"
      contains: "connect(), disconnect(), PostConditionMode.Deny, Pc.principal"
      max_lines: 200
  key_links:
    - from: "skills/stacks-dev/references/clarity-frontend.md"
      to: "https://docs.stacks.co/stacks-connect/connect-wallet"
      via: "External References section"
---

<objective>
Update clarity-frontend.md reference file with current @stacks/connect v8+ API patterns, post-conditions, and transaction polling.

Purpose: Replace outdated v7 patterns (showConnect, UserSession) with v8+ API and add critical security patterns (post-conditions) that protect users from malicious contracts.

Output: Updated clarity-frontend.md under 200 lines with modern Stacks.js patterns.
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-frontend-integration/06-RESEARCH.md
@skills/stacks-dev/references/clarity-frontend.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update clarity-frontend.md with v8+ patterns</name>
  <files>skills/stacks-dev/references/clarity-frontend.md</files>
  <action>
Replace the entire clarity-frontend.md file with updated content:

1. **Update Wallet Integration section:**
   - Replace `showConnect`, `AppConfig`, `UserSession` with v8+ `connect()`, `disconnect()`, `isConnected()`, `getLocalStorage()`
   - Use pattern from 06-RESEARCH.md "Pattern 1: Authentication Context Provider"

2. **Add Post-Conditions section (NEW - critical):**
   - Add section between Contract Calls and Network Configuration
   - Explain post-conditions protect users from unexpected asset transfers
   - Show `Pc` fluent API examples from 06-RESEARCH.md "Pattern 2"
   - Emphasize `PostConditionMode.Deny` is ALWAYS required

3. **Update Contract Calls section:**
   - Replace `callReadOnlyFunction` with `fetchCallReadOnlyFunction`
   - Use `Cl` helpers instead of manual `principalCV`, `uintCV`
   - Add `validateWithAbi: true` recommendation

4. **Update Network Configuration:**
   - Add `NEXT_PUBLIC_STACKS_NETWORK` environment variable pattern
   - Show devnet URL override: `new StacksDevnet({ url: 'http://localhost:20443' })`

5. **Add Transaction Status section (NEW):**
   - Add polling pattern from 06-RESEARCH.md "Pattern 5"
   - Show 2-second interval, 30 attempt limit
   - Note that onFinish fires on broadcast, not confirmation

6. **Update React Patterns section:**
   - Update AuthContext to use v8+ API
   - Update useContractCall hook with error handling

7. **Update External References:**
   - Add post-conditions docs link
   - Verify all links point to current docs

Target: Under 200 lines total. Be concise - link to docs for details.
  </action>
  <verify>
wc -l skills/stacks-dev/references/clarity-frontend.md
# Must be under 200 lines

grep -q "connect()" skills/stacks-dev/references/clarity-frontend.md
grep -q "PostConditionMode.Deny" skills/stacks-dev/references/clarity-frontend.md
grep -q "Pc.principal" skills/stacks-dev/references/clarity-frontend.md
grep -q "fetchCallReadOnlyFunction" skills/stacks-dev/references/clarity-frontend.md
grep -q "NEXT_PUBLIC_STACKS_NETWORK" skills/stacks-dev/references/clarity-frontend.md
# All patterns must be present
  </verify>
  <done>
clarity-frontend.md updated with:
- v8+ connect() API replacing showConnect/UserSession
- Post-conditions section with Pc fluent API
- Transaction polling pattern
- Environment-based network config
- File under 200 lines
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Line count verification:
   ```bash
   wc -l skills/stacks-dev/references/clarity-frontend.md
   ```
   Must be under 200 lines.

2. Pattern verification:
   ```bash
   grep -c "showConnect\|UserSession\|AppConfig" skills/stacks-dev/references/clarity-frontend.md
   ```
   Must return 0 (no deprecated patterns).

3. Required content:
   ```bash
   grep -E "connect\(\)|PostConditionMode\.Deny|Pc\.principal|fetchCallReadOnlyFunction|NEXT_PUBLIC_STACKS_NETWORK" skills/stacks-dev/references/clarity-frontend.md | wc -l
   ```
   Must return at least 5 (all key patterns present).
</verification>

<success_criteria>
1. clarity-frontend.md uses @stacks/connect v8+ API (no showConnect, UserSession, AppConfig)
2. Post-conditions section exists with Pc fluent API examples
3. Transaction status polling pattern included
4. Network configuration uses environment variables
5. File stays under 200 lines
6. All external reference links are current
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-integration/06-01-SUMMARY.md`
</output>
